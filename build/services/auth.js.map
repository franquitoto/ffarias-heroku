{"version":3,"file":"auth.js","names":["strategyOptions","usernameField","passwordField","passReqToCallback","login","req","username","password","done","logger","info","UserModel","findOne","user","isValidPassword","mensaje","trace","signup","create","newUser","error","err","loginFunc","LocalStrategy","signUpFunc","passport","serializeUser","_id","deserializeUser","userId","findById","then"],"sources":["../../src/services/auth.js"],"sourcesContent":["import passport from 'passport';\r\nimport { Strategy as LocalStrategy } from 'passport-local';\r\nimport {UserModel} from '../models/user';\r\nimport { logger } from './logger';\r\n\r\nconst strategyOptions = {\r\n  usernameField: 'usuario',\r\n  passwordField: 'contrasena',\r\n  passReqToCallback: true,\r\n};\r\n\r\nconst login = async (req, username, password, done) => {\r\n  logger.info('LOGIN!!');\r\n  const user = await UserModel.findOne({ username});\r\n\r\n  if (!user || !user.isValidPassword(password)) return done(null, false, { mensaje: 'Usuario no encontrado' });\r\n\r\n  logger.trace('ENCONTRE UN USUARIO');\r\n  return done(null, user);\r\n};\r\n\r\nconst signup = async (req, username, password, done) => {\r\n  logger.trace('SIGNUP!!');\r\n  try {\r\n    const newUser = await UserModel.create({ username, password });\r\n    return done(null, newUser);\r\n  } catch (err) {\r\n    logger.error(`Hubo un error ${err}`)\r\n    return done(null, false, { mensaje: 'Error Inesperado', err });\r\n  }\r\n};\r\n\r\nexport const loginFunc = new LocalStrategy(strategyOptions, login);\r\nexport const signUpFunc = new LocalStrategy(strategyOptions, signup);\r\n\r\n\r\n/**\r\n * Express-session crea un objeto session en la request\r\n * passport agrega a req.session un objeto llamado passport para guardar la info del usuario\r\n * Cuando llamamos a done en login o en signup y pasamos el usuario lo siguiente que ocurre es que se ejecuta passport.serializeUser\r\n * Esta funcion agarra el usuario que recibio y lo guarda en req.session.passport \r\n * En este caso estamos creando una key llamado user con la info del usuario dentro de req.session.passport\r\n */\r\n passport.serializeUser((user, done) => {\r\n  logger.trace('Se Ejecuta el serializeUser');\r\n  done(null, user._id);\r\n});\r\n\r\n/**\r\n * DeserializeUser Permite tomar la info que mandamos con el serializeUser para hacer algun extra de busqueda de informacion\r\n */\r\n passport.deserializeUser((userId, done) => {\r\n  logger.trace('Se Ejecuta el desserializeUser');\r\n  UserModel.findById(userId).then((user) => {\r\n    return done(null, user);\r\n  })\r\n});"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;+CAFA,oJ;;;;;;AAIA,IAAMA,eAAe,GAAG;EACtBC,aAAa,EAAE,SADO;EAEtBC,aAAa,EAAE,YAFO;EAGtBC,iBAAiB,EAAE;AAHG,CAAxB;;AAMA,IAAMC,KAAK;EAAA,sEAAG,iBAAOC,GAAP,EAAYC,QAAZ,EAAsBC,QAAtB,EAAgCC,IAAhC;IAAA;IAAA;MAAA;QAAA;UAAA;YACZC,cAAA,CAAOC,IAAP,CAAY,SAAZ;;YADY;YAAA,OAEOC,eAAA,CAAUC,OAAV,CAAkB;cAAEN,QAAQ,EAARA;YAAF,CAAlB,CAFP;;UAAA;YAENO,IAFM;;YAAA,MAIR,CAACA,IAAD,IAAS,CAACA,IAAI,CAACC,eAAL,CAAqBP,QAArB,CAJF;cAAA;cAAA;YAAA;;YAAA,iCAIyCC,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;cAAEO,OAAO,EAAE;YAAX,CAAd,CAJ7C;;UAAA;YAMZN,cAAA,CAAOO,KAAP,CAAa,qBAAb;;YANY,iCAOLR,IAAI,CAAC,IAAD,EAAOK,IAAP,CAPC;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAH;;EAAA,gBAALT,KAAK;IAAA;EAAA;AAAA,GAAX;;AAUA,IAAMa,MAAM;EAAA,uEAAG,kBAAOZ,GAAP,EAAYC,QAAZ,EAAsBC,QAAtB,EAAgCC,IAAhC;IAAA;IAAA;MAAA;QAAA;UAAA;YACbC,cAAA,CAAOO,KAAP,CAAa,UAAb;;YADa;YAAA;YAAA,OAGWL,eAAA,CAAUO,MAAV,CAAiB;cAAEZ,QAAQ,EAARA,QAAF;cAAYC,QAAQ,EAARA;YAAZ,CAAjB,CAHX;;UAAA;YAGLY,OAHK;YAAA,kCAIJX,IAAI,CAAC,IAAD,EAAOW,OAAP,CAJA;;UAAA;YAAA;YAAA;;YAMXV,cAAA,CAAOW,KAAP;;YANW,kCAOJZ,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;cAAEO,OAAO,EAAE,kBAAX;cAA+BM,GAAG;YAAlC,CAAd,CAPA;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAH;;EAAA,gBAANJ,MAAM;IAAA;EAAA;AAAA,GAAZ;;AAWO,IAAMK,SAAS,GAAG,IAAIC,uBAAJ,CAAkBvB,eAAlB,EAAmCI,KAAnC,CAAlB;;AACA,IAAMoB,UAAU,GAAG,IAAID,uBAAJ,CAAkBvB,eAAlB,EAAmCiB,MAAnC,CAAnB;AAGP;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACCQ,oBAAA,CAASC,aAAT,CAAuB,UAACb,IAAD,EAAOL,IAAP,EAAgB;EACtCC,cAAA,CAAOO,KAAP,CAAa,6BAAb;;EACAR,IAAI,CAAC,IAAD,EAAOK,IAAI,CAACc,GAAZ,CAAJ;AACD,CAHA;AAKD;AACA;AACA;;;AACCF,oBAAA,CAASG,eAAT,CAAyB,UAACC,MAAD,EAASrB,IAAT,EAAkB;EAC1CC,cAAA,CAAOO,KAAP,CAAa,gCAAb;;EACAL,eAAA,CAAUmB,QAAV,CAAmBD,MAAnB,EAA2BE,IAA3B,CAAgC,UAAClB,IAAD,EAAU;IACxC,OAAOL,IAAI,CAAC,IAAD,EAAOK,IAAP,CAAX;EACD,CAFD;AAGD,CALA"}