{"version":3,"file":"socket.js","names":["webSocket","usuarios","myWSServer","io","myServer","on","socket","logger","info","id","client","usuario","push","emit","data","save","productos","getAll","index","indexOf","mensaje"],"sources":["../../src/services/socket.js"],"sourcesContent":["import myServer from './server';\r\nimport io from 'socket.io';\r\nimport { save, getAll } from '../controllers/productos';\r\nimport { logger } from './logger';\r\n\r\nexport const webSocket = () => {\r\n    const usuarios = []\r\n    const myWSServer = io(myServer);\r\n    myWSServer.on('connection', (socket) => {\r\n        logger.info('un cliente se a conectado');\r\n        logger.info('socket del server', socket.id);\r\n        logger.info('socket del cliente', socket.client.id);\r\n        let usuario = socket.client.id;\r\n        usuarios.push(usuario)\r\n        socket.emit('newYser', usuario);\r\n        socket.on('message', (data) =>{\r\n            save(data) \r\n            let productos;\r\n            (\r\n                async () =>{\r\n                    productos = await getAll();\r\n                    myWSServer.emit('response', productos);\r\n                }\r\n            )()\r\n            \r\n        })\r\n        socket.on('chat', (data) =>{\r\n            let index = usuarios.indexOf(usuario);\r\n            logger.info(data)\r\n            const mensaje = {\r\n                usuario: usuario,\r\n                mensaje: data,\r\n                index: index\r\n            }\r\n            myWSServer.emit('mensaje+usuario', mensaje);\r\n        })\r\n    })\r\n} "],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;+CAFA,oJ;;;;;;AAIO,IAAMA,SAAS,GAAG,SAAZA,SAAY,GAAM;EAC3B,IAAMC,QAAQ,GAAG,EAAjB;EACA,IAAMC,UAAU,GAAG,IAAAC,kBAAA,EAAGC,kBAAH,CAAnB;EACAF,UAAU,CAACG,EAAX,CAAc,YAAd,EAA4B,UAACC,MAAD,EAAY;IACpCC,cAAA,CAAOC,IAAP,CAAY,2BAAZ;;IACAD,cAAA,CAAOC,IAAP,CAAY,mBAAZ,EAAiCF,MAAM,CAACG,EAAxC;;IACAF,cAAA,CAAOC,IAAP,CAAY,oBAAZ,EAAkCF,MAAM,CAACI,MAAP,CAAcD,EAAhD;;IACA,IAAIE,OAAO,GAAGL,MAAM,CAACI,MAAP,CAAcD,EAA5B;IACAR,QAAQ,CAACW,IAAT,CAAcD,OAAd;IACAL,MAAM,CAACO,IAAP,CAAY,SAAZ,EAAuBF,OAAvB;IACAL,MAAM,CAACD,EAAP,CAAU,SAAV,EAAqB,UAACS,IAAD,EAAS;MAC1B,IAAAC,eAAA,EAAKD,IAAL;MACA,IAAIE,SAAJ;;MACA,2DACI;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACsB,IAAAC,iBAAA,GADtB;;cAAA;gBACID,SADJ;gBAEId,UAAU,CAACW,IAAX,CAAgB,UAAhB,EAA4BG,SAA5B;;cAFJ;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CADJ;IAOH,CAVD;IAWAV,MAAM,CAACD,EAAP,CAAU,MAAV,EAAkB,UAACS,IAAD,EAAS;MACvB,IAAII,KAAK,GAAGjB,QAAQ,CAACkB,OAAT,CAAiBR,OAAjB,CAAZ;;MACAJ,cAAA,CAAOC,IAAP,CAAYM,IAAZ;;MACA,IAAMM,OAAO,GAAG;QACZT,OAAO,EAAEA,OADG;QAEZS,OAAO,EAAEN,IAFG;QAGZI,KAAK,EAAEA;MAHK,CAAhB;MAKAhB,UAAU,CAACW,IAAX,CAAgB,iBAAhB,EAAmCO,OAAnC;IACH,CATD;EAUH,CA5BD;AA6BH,CAhCM"}