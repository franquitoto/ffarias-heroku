{"version":3,"file":"index.js","names":["router","Router","usuarios","user","pass","passportOptions","badRequestMessage","isLoggedIn","req","res","next","logger","trace","isAuthenticated","render","msg","get","session","nombre","userSesion","indexPath","path","resolve","__dirname","loginPath","signupPath","post","passport","authenticate","failureRedirect","username","err","info","console","log","status","json","destroy","redirect","getAll","productos","msj"],"sources":["../../src/routes/index.js"],"sourcesContent":["import { Router } from \"express\";\r\nimport util from 'util';\r\nimport passport from \"passport\";\r\nimport path from \"path\";\r\nimport { logger } from \"../services/logger\";\r\nimport { getAll } from \"../controllers/productos\";\r\n\r\n\r\nconst router = Router();\r\n\r\n\r\nlet usuarios = [\r\n  { user: 'Franco', pass: 'arias' },\r\n  { user: 'Leandro', pass: 'bordon' }\r\n]\r\nconst passportOptions = {badRequestMessage: 'Falta username / contraseÃ±a'};\r\nconst isLoggedIn = (req, res, next) => {\r\n  logger.trace('Is Authenticated')\r\n  logger.trace(req.isAuthenticated());\r\n  if (!req.isAuthenticated()) return res.render({ msg: 'aca no pasas' });\r\n\r\n  next();\r\n}\r\nrouter.get('/', (req, res) => {\r\n  if(req.session.nombre){\r\n    const userSesion = req.session.nombre\r\n    res.render('index',{userSesion} );\r\n  }else{\r\n    res.render('login')\r\n  }\r\n  \r\n})\r\n/* --------- index ---------- */\r\nrouter.get('/index', (req, res) => {\r\n  const indexPath = path.resolve(__dirname, '../../views/index');\r\n  res.render('index');\r\n});\r\n/* --------- login ---------- */\r\nrouter.get('/login', (req, res) => {\r\n  const loginPath = path.resolve(__dirname, '../../views/login');\r\n  res.render('login');\r\n});\r\n/* --------- signup ---------- */\r\nrouter.get('/signup', (req, res) => {\r\n  const signupPath = path.resolve(__dirname, '../../views/signup');\r\n  res.render('signup');\r\n});\r\nrouter.post(\r\n  '/login',\r\n  passport.authenticate('login', {failureRedirect:'/signup'}),\r\n  (req, res) => {\r\n    // res.json({ msg: 'Welcome!', user: req.user });\r\n\r\n    const userSesion = req.user.username\r\n    res.render('index',{userSesion} );\r\n  },\r\n);\r\n// router.post('/login', (req, res) => {\r\n//   let { user, pass } = req.body;\r\n//   let credencialesOk = usuarios.filter(\r\n//     (usuario) => usuario.user == user && usuario.pass == pass\r\n//   ).length;\r\n//   if (credencialesOk) {\r\n//     req.session.nombre = user;\r\n//     req.session.contador = 0;\r\n//     const userSesion = req.session.nombre\r\n//     console.log(userSesion)\r\n//     console.log(\"Ingreso exitoso\");\r\n//     res.render('index',{userSesion} );\r\n//   } else {\r\n//     console.log(\"No estas autorizado\");\r\n//   }\r\n// })\r\nrouter.post('/signup', (req, res, next) => {\r\n  passport.authenticate('signup', passportOptions, (err, user, info) => {\r\n    console.log('Info SIGNUP');\r\n    console.log(err, user, info);\r\n    if (err) {\r\n      return next(err);\r\n    }\r\n    if (!user) return res.status(401).json(info);\r\n\r\n    // res.json({ msg: 'signup OK' });\r\n    res.render('login');\r\n  })(req, res, next);\r\n});\r\n\r\n\r\n\r\nrouter.get('/logout', (req, res) => {\r\n  \r\n  req.session.destroy((err) => {\r\n    res.redirect('/');\r\n  });\r\n  \r\n});\r\nrouter.get('/info', async (req, res) =>{\r\n  const productos = await getAll();\r\n  res.json({\r\n    msj: productos\r\n  })\r\n})\r\n\r\n\r\nexport default router;"],"mappings":"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"}